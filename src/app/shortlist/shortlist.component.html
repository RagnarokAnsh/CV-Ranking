<app-navbar>
  <div class="shortlist-container">
    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Left Column: Upload Section + Filters -->
      <div class="left-column">
        <!-- Page Header -->
        <div class="page-header">
          <h1>SHORT LISTING</h1>
        </div>
        
        <!-- Upload Section -->
        <div class="upload-section">
          <div class="upload-card">
            <h3>Upload Job Description (JD) or CVs</h3>
            
            <!-- Drag and Drop Area -->
                      <div class="upload-drop-zone" 
               (dragover)="onDragOver($event)" 
               (dragleave)="onDragLeave($event)"
               (drop)="onFileDrop($event)"
               [class.disabled]="isSubmitting">
              <div class="upload-content">
                <!-- <i class="pi pi-cloud-upload upload-icon"></i> -->
                <p class="upload-text">Drag and drop file here</p>
                <p class="upload-limit">Limit 200MB per file â€¢ PDF</p>
              </div>
              
              <!-- Browse Files Button -->
              <p-fileUpload 
                mode="basic" 
                [multiple]="false"
                accept=".pdf"
                [maxFileSize]="200000000"
                (onSelect)="onFileSelect($event)"
                [auto]="false"
                [disabled]="isSubmitting"
                chooseLabel="Browse files"
                class="browse-button">
              </p-fileUpload>
            </div>
            
            <!-- Selected File Display -->
            <div class="selected-file" *ngIf="selectedFile">
              <i class="pi pi-file-pdf file-icon"></i>
              <span class="filelabel">{{ selectedFile.name }}</span>
              <button type="button" class="remove-file-btn" (click)="removeSelectedFile()">
                <i class="pi pi-times"></i>
              </button>
            </div>
            
           
          </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
          <h3>Filters</h3>
          
          <div class="filters-grid">
            <!-- Job Description Template -->
            <div class="filter-field">
              <label>Job Description Template</label>
              <div class="radio-group">
                <div *ngFor="let template of jobDescriptionTemplates" class="radio-option">
                  <input 
                    type="radio" 
                    [id]="template.value" 
                    name="jobTemplate" 
                    [value]="template.value" 
                    [(ngModel)]="selectedJobTemplate"
                    class="custom-radio">
                  <label [for]="template.value" class="radio-label">{{ template.label }}</label>
                </div>
              </div>
            </div>

            <!-- Search Query -->
            <div class="filter-field">
              <label>Search query</label>
              <input 
                type="text" 
                pInputText 
                [(ngModel)]="searchQuery" 
                placeholder="Enter search query"
                class="search-input">
            </div>

            <!-- Search Operator -->
            <div class="filter-field">
              <label>Search operator</label>
              <div class="radio-group">
                <div *ngFor="let operator of searchOperatorOptions" class="radio-option">
                  <input 
                    type="radio" 
                    [id]="operator.value" 
                    name="searchOperator" 
                    [value]="operator.value" 
                    [(ngModel)]="selectedSearchOperator"
                    class="custom-radio">
                  <label [for]="operator.value" class="radio-label">{{ operator.label }}</label>
                </div>
              </div>
            </div>

            <!-- Weight for Experience -->
            <div class="filter-field">
              <label>Weight for Experience</label>
              <div class="weight-counter">
                <button 
                  type="button" 
                  class="counter-btn minus-btn" 
                  (click)="adjustWeight('experience', false)"
                  [disabled]="weightExperience <= 0">
                  -
                </button>
                <span class="weight-value">{{ weightExperience.toFixed(2) }}</span>
                <button 
                  type="button" 
                  class="counter-btn plus-btn" 
                  (click)="adjustWeight('experience', true)"
                  [disabled]="weightExperience >= 1">
                  +
                </button>
              </div>
            </div>

            <!-- Weight for Qualifications -->
            <div class="filter-field">
              <label>Weight for Qualifications</label>
              <div class="weight-counter">
                <button 
                  type="button" 
                  class="counter-btn minus-btn" 
                  (click)="adjustWeight('qualifications', false)"
                  [disabled]="weightQualifications <= 0">
                  -
                </button>
                <span class="weight-value">{{ weightQualifications.toFixed(2) }}</span>
                <button 
                  type="button" 
                  class="counter-btn plus-btn" 
                  (click)="adjustWeight('qualifications', true)"
                  [disabled]="weightQualifications >= 1">
                  +
                </button>
              </div>
            </div>

            <!-- Weight for Skills -->
            <div class="filter-field">
              <label>Weight for Skills</label>
              <div class="weight-counter">
                <button 
                  type="button" 
                  class="counter-btn minus-btn" 
                  (click)="adjustWeight('skills', false)"
                  [disabled]="weightSkills <= 0">
                  -
                </button>
                <span class="weight-value">{{ weightSkills.toFixed(2) }}</span>
                <button 
                  type="button" 
                  class="counter-btn plus-btn" 
                  (click)="adjustWeight('skills', true)"
                  [disabled]="weightSkills >= 1">
                  +
                </button>
              </div>
            </div>

            <!-- Validation Error -->
            <div class="validation-error" *ngIf="weightValidationError">
              <i class="pi pi-exclamation-triangle"></i>
              <span>{{ weightValidationError }}</span>
            </div>

            <!-- Selected Minimum Years of Experience -->
            <div class="filter-field selected-filter">
              <label>Selected Minimum Years of Experience: {{ selectedMinYearsExperience }} years</label>
            </div>

            <!-- Selected Required Degree -->
            <div class="filter-field selected-filter">
              <label>Selected Required Degree: {{ selectedRequiredDegree }}</label>
            </div>

            <!-- Selected Gender Filter -->
            <div class="filter-field selected-filter">
              <label>Selected Gender Filter: {{ selectedGenderFilter }}</label>
            </div>

            <!-- CVs Count Info -->
            <div class="filter-field selected-filter">
              <label>Total Filtered CVs: {{ filteredResumeData.length }}</label>
            </div>
          </div>

          <!-- Filter Action Buttons -->
          <div class="filter-actions">
            <button 
              pButton 
              type="button" 
              [label]="isSubmitting ? 'Processing...' : 'Submit'" 
              class="apply-btn"
              [disabled]="isSubmitting"
              (click)="submitRanking()">
              <i class="pi pi-spin pi-spinner" *ngIf="isSubmitting" style="margin-right: 0.5rem;"></i>
            </button>
            <button 
              pButton 
              type="button" 
              label="Reset" 
              class="reset-filter-btn"
              [disabled]="isSubmitting"
              (click)="resetRanking()">
            </button>

          </div>
        </div>
      </div>

      <!-- Right Content Area -->
      <div class="right-column">
        <!-- Job Description Section -->
        <div class="job-description-section">
          <h3>Job Description Content</h3>
          <h4 class="extracted-sections-title">Extracted Sections</h4>
          <div class="job-description-card">
            <div class="job-description-content">
              <div *ngIf="jobDescriptionContent === 'Upload a job description file or select a template to see the extracted content here.'" 
                   class="placeholder-text">
                <p>{{ jobDescriptionContent }}</p>
              </div>
              <div *ngIf="jobDescriptionContent !== 'Upload a job description file or select a template to see the extracted content here.'" 
                   class="formatted-content">
                <pre>{{ jobDescriptionContent }}</pre>
              </div>
            </div>
          </div>
        </div>

        <!-- Ranking Results Section -->
        <div class="ranking-section">
          <h3>Ranking Results</h3>
          


          <!-- Loading Message -->
          <div *ngIf="filteredResumeData.length === 0 && rankingResults.length === 0" class="no-data-message">
            <i class="pi pi-info-circle"></i>
            <p>No CV data available. Please go to Long Listing first to upload and filter CVs, or use the test button.</p>
          </div>

          <!-- Results Table -->
          <p-table 
            *ngIf="rankingResults.length > 0"
            [value]="rankingResults" 
            [paginator]="rankingResults.length > 8"
            [rows]="8"
            [showCurrentPageReport]="rankingResults.length > 8"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            class="ranking-table">
            
            <ng-template pTemplate="header">
              <tr>
                <th>Rank</th>
                <th>CV ID</th>
                <th>Name</th>
                <th>Highest Degree</th>
                <th>YOE</th>
                <th>Final Score</th>
                <th>Gender</th>
                <th>Nationality</th>
              </tr>
            </ng-template>
            
            <ng-template pTemplate="body" let-result>
              <tr>
                <td>{{ result.rank || '--' }}</td>
                <td>{{ result.cvId || 'N/A' }}</td>
                <td>{{ result.name || 'Unknown' }}</td>
                <td>{{ result.highestDegree || 'N/A' }}</td>
                <td>{{ result.yoe || 'N/A' }}</td>
                <td>{{ result.finalScore || '--' }}</td>
                <td>{{ result.gender || 'Unknown' }}</td>
                <td>{{ result.nationality || 'Unknown' }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>

    <!-- Employment History Section - Full Width at Bottom -->
    <div class="bottom-section">
      <div class="employment-history-section">
        <h3>View Extracted Employment History</h3>
        
        <!-- No Employment History Message -->
        <div *ngIf="employmentHistory.length === 0" class="no-employment-message">
          <i class="pi pi-info-circle"></i>
          <p>Employment history will appear here after processing the ranking. Please submit your filters to see detailed employment information.</p>
        </div>

        <!-- Employment History Accordion -->
        <div *ngIf="employmentHistory.length > 0" class="employment-accordion-container" [class.scrollable]="employmentHistory.length > 5">
          <p-accordion [multiple]="false" class="employment-accordion">
            <p-accordionTab 
              *ngFor="let history of employmentHistory" 
              [header]="(history.id || 'CV') + ' - ' + (history.name || 'Unknown')">
              <div class="employment-details">
                <pre>{{ history.details || 'No employment details available' }}</pre>
              </div>
            </p-accordionTab>
          </p-accordion>
        </div>
      </div>
    </div>
  </div>

</app-navbar>
